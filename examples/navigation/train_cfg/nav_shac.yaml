# 文件创建为:
# bigbigworld123/depthnav/depthNav-main/examples/navigation/train_cfg/nav_shac.yaml

env_class: navigation_env
env:
  # (您可以从 nav_levelX.yaml 复制 'env:' 的所有内容)
  num_envs: 8
  seed: 42
  visual: True
  single_env: True
  base_action: [0., 0., 0.]
  robot_radius: 0.3
  random_kwargs:
    safe_spawn_radius: 0.1
    min_starting_distance_to_target: 0.1
    position:
      class: cylinder
      mean: [0., 0., 1.5]
      half: [12.5, 12.5, 1.]
    velocity:
      class: uniform
      mean: [0., 0., 0.]
      half: [0.5, 0.5, 0.5]
    rotation:
      class: normal 
      mean: [0., 0., 0.]
      half: [0., 0., 0.2]
    target:
      class: uniform
      mean: [0., 0., 1.5]
      half: [0., 0., 0.]
    target_speed: 
      class: uniform
      mean: [3.]
      half: [2.]
    velocity_noise:
      class: normal
      mean: [0., 0., 0.]
      half: [0.05, 0.05, 0.05]
    rotation_noise:
      class: normal 
      mean: [0., 0., 0.]
      half: [0.02, 0.02, 0.02]
    gravity:
      class: normal
      mean: [0., 0., -9.81]
      half: [0., 0., 1.5]
  dynamics_kwargs:
    action_type: thrust_world_frame
    dt: 0.02
    ctrl_dt: 0.02
    ctrl_delay: 0.0
    grad_decay: 0.92
    avg_velocity_window_dt: 2.0
    vel_smoothing_factor: 0.8
    exp_smoothing_factor: 12.
    enable_ctrl_smoothing: False
    enable_air_drag: False
    air_drag_theta_1: 0.1
    air_drag_theta_2: 0.1
  scene_kwargs:
    path: configs/level_1
    reload_scenes: True
    load_geodesics: True
    spawn_obstacles: False
  sensor_kwargs:
    - sensor_type: depth
      uuid: depth
      resolution: [72, 128]
      position: [0.1, -0.02, -0.04]
      orientation: [0, 0, 0]
      far: 20.
      near: 0.25
  target_kwargs:
    success_radius: 0.1
  reward_kwargs:
    beta_1: 2.5
    beta_2: -6 
    lambda_v: 4
    lambda_c: 6 
    lambda_a: 0.01
    lambda_j: 0.001
    lambda_om: 0.3
    lambda_yaw: 4.0
    lambda_vmax: 1.0
    falloff_dis: 1.0
  max_episode_steps: 600
  device: cpu

# --- 关键修改：替换 BPTT 为 SHAC ---
# (参数来自 grad_nav/examples/cfg/gradnav/drone_long_traj.yaml)
train_shac:
  iterations: 10000               # 对应 grad_nav 的 max_epochs
  actor_learning_rate: 1.0e-4
  critic_learning_rate: 1.0e-4
  lr_schedule: cosine
  weight_decay: 0.01
  
  steps_num: 32                   # 关键：短时窗 (Short-Horizon)
  
  gamma: 0.99
  lambda_val: 0.95                # 对应 'lambda'
  critic_iterations: 16           # 每次迭代时 Critic 更新的次数
  num_batch: 4                    # 用于 Critic 训练的 batch 数量
  grad_norm: 1.0
  betas: [0.7, 0.95]
  target_critic_alpha: 0.2

  # (可选参数，我们在 shac_algorithm.py 中实现了它们)
  obs_rms: True
  ret_rms: False
  LPF_train: False
  LPF_val: 0.5
  
  # (日志参数，来自 depthNav)
  log_interval: 100
  checkpoint_interval: 500
  early_stop_reward_threshold: -150
  device: cuda